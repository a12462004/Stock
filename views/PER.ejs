<!DOCTYPE html>
<html lang="en">
<%- include header.ejs %>
<title><%= title %></title> 
  <body>
    <%- include content_head.ejs %> 
    <div class="container-fluid">
      <div class="row">
        <%- include sidebar.ejs %> 
  
        <div class="text-center" >
          <div class=col-sm-10 style="background-color: #f8f8fa;opacity: 0.9;">
            <div id="upper_row" class="row">
                <%- include up_contend.ejs %> 
              
            </div>
          </div>
          <div class=col-sm-10>
            <div id="main1" style="height:400px;padding-top: 20px;"></div>
          </div>
          <div>
            <div id="sencondTitle" class="col-sm-10">
              <h2 class="page-header" >本益比</h2>
            </div>
            <div class="table-responsive col-sm-10">
              <table class="table table-striped table-bordered" style="width:100%;font-size: 20px">
                <thead>
                  <th class="warning">年月</th>
                  <th class="warning">開盤價</th>
                  <th class="warning">最高價</th>
                  <th class="warning">最低價</th>
                  <th class="warning">收盤價</th>
                  <th class="warning">本益比</th>
                </thead>
                <tbody>
                  <% for(var i=0; i<data.length; i++) {%>
                    <tr>
                      <td>
                        <%= data[i].date%>
                      </td>
                      <td>
                        <%= data[i].open%>
                      </td>
                      <td>
                        <%= data[i].up%>
                      </td>
                      <td>
                        <%= data[i].down%>
                      </td>
                      <td>
                        <%= data[i].clos%>
                      </td>
                      <td>
                        <%= data[i].pe_ratio%>
                      </td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        </div> 
        </div>
      </div>
    </div>
    <script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
    <script type="text/javascript">
      $.ajax({
              url: '/PER/getChartData',
              type: 'POST',
              dataType: 'JSON',
              data:{code:<%= data[0].code %>},
              success: function(ChartData) {
                var year = [];
                var pe_ratio = [];
                var open = [];
                var up = [];
                var down = [];
                var clos = [];
                for (var i = 0; i < ChartData.length; i++) {
                  year.push(ChartData[i].date);
                  pe_ratio.push(ChartData[i].pe_ratio);
                  open.push(ChartData[i].open);
                  up.push(ChartData[i].up);
                  down.push(ChartData[i].down);
                  clos.push(ChartData[i].clos);
                }
                require.config({
                  paths: {
                    echarts: 'http://echarts.baidu.com/build/dist'
                  }
                });
                require(
                [
                  'echarts',
                  'echarts/chart/bar',
                  'echarts/chart/line'
                ],
                function (ec) {
                  var myChart = ec.init(document.getElementById('main1')); 
                  var option = {
                        tooltip: {
                            trigger: 'axis'
                        },
                        legend: {
                            data:['本益比','月收盤價']
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        toolbox: {
                            feature: {
                                saveAsImage: {}
                            }
                        },
                        xAxis: {
                            type: 'category',
                            boundaryGap: false,
                            data: year
                        },
                        yAxis:[ {
                            type: 'value',
                            position:'left',
                            name:'百分比'
                        },{
                            type: 'value',
                            position:'right',
                            name:'元'
                        }],
                        series: [
                            {
                                name:'本益比',
                                type:'line',
                                stack: '本益比',
                                // 顏色變換
                                itemStyle: {normal: {color:'rgba(184,208,0,1)'}},
                                data: pe_ratio
                            },{
                                name:'月收盤價',
                                type:'line',
                                yAxisIndex: 1,
                                stack: '月收盤價',
                                data: clos
                            }
                        ]
                    };
                  myChart.setOption(option); 
               });
              }
            });
    </script>
  </body>
</html>
