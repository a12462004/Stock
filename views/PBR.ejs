<!DOCTYPE html>
<html lang="en">
<%- include header.ejs %> 
  <body>
    <%- include content_head.ejs %> 
    <div class="container-fluid">
      <div class="row">
        <%- include sidebar.ejs %> 

        <div class="text-center">
          <div class=col-sm-10>
            <div id="upper_row" class="row">

            <div class="col-xs-6 " >
              <img src="../images/taiwancement.png" class=" img-circle" style="float:right;width:300px; height:300;" >
            </div>  
            <div class="col-xs-6 " style="height:200px;width:400px;text-align:left;">
              <h3 class="valign">
              <%= data[0].code %>
              <br/><br/><%= data[0].company %>
              </h3>
            </div>
          </div>
          </div>
          <div class=col-sm-10>
            <div id="main1" style="height:400px;"></div>
          </div>
          <div>
            <div id="sencondTitle" class="col-sm-10">
              <h2 class="page-header" >淨值比</h2>
            </div>
            <div class="table-responsive col-sm-10">
              <table class="table table-striped table-bordered" style="width:100%;font-size: 20px">
                <thead>
                  <th class="warning">年月</th>
                  <th class="warning">開盤價</th>
                  <th class="warning">最高價</th>
                  <th class="warning">最低價</th>
                  <th class="warning">收盤價</th>
                  <th class="warning">淨值比</th>
                </thead>
                <tbody>
                  <% for(var i=0; i<data.length; i++) {%>
                    <tr>
                      <td>
                        <%= data[i].price_date%>
                      </td>
                      <td>
                        <%= data[i].open%>
                      </td>
                      <td>
                        <%= data[i].up%>
                      </td>
                      <td>
                        <%= data[i].down%>
                      </td>
                      <td>
                        <%= data[i].clos%>
                      </td>
                      <td>
                        <%= data[i].net_ratio%>
                      </td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        </div> 
        </div>
      </div>
    </div>
    <script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
    <script type="text/javascript">
      $.ajax({
              url: '/PBR/getChartData',
              type: 'POST',
              dataType: 'JSON',
              data:{code:<%= data[0].code %>},
              success: function(ChartData) {
                var year = [];
                var pe_ratio = [];
                var net_ratio = [];
                var open = [];
                var up = [];
                var down = [];
                var clos = [];
                for (var i = 0; i < ChartData.length; i++) {
                  year.push(ChartData[i].date);
                  pe_ratio.push(ChartData[i].pe_ratio);
                  net_ratio.push(ChartData[i].net_ratio);
                  open.push(ChartData[i].open);
                  up.push(ChartData[i].up);
                  down.push(ChartData[i].down);
                  clos.push(ChartData[i].clos);
                }
                require.config({
                  paths: {
                    echarts: 'http://echarts.baidu.com/build/dist'
                  }
                });
                require(
                [
                  'echarts',
                  'echarts/chart/bar',
                  'echarts/chart/line'
                ],
                function (ec) {
                  var myChart = ec.init(document.getElementById('main1')); 
                  var option = {
                        tooltip: {
                            trigger: 'axis'
                        },
                        legend: {
                            data:['淨值比','月收盤價']
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        toolbox: {
                            feature: {
                                saveAsImage: {}
                            }
                        },
                        xAxis: {
                            type: 'category',
                            boundaryGap: false,
                            data: year
                        },
                        yAxis:[ {
                            type: 'value',
                            position:'left',
                            name:'百分比'
                        },{
                            type: 'value',
                            position:'right',
                            name:'元'
                        }],
                        series: [
                            {
                                name:'淨值比',
                                type:'line',
                                itemStyle: {normal: {color:'rgba(58,148,236,1)'}},
                                stack: '淨值比',
                                data: net_ratio
                            },{
                                name:'月收盤價',
                                type:'line',
                                yAxisIndex: 1,
                                stack: '月收盤價',
                                data: clos
                            }
                        ]
                    };
                  myChart.setOption(option); 
               });
              }
            });
    </script>
  </body>
</html>
